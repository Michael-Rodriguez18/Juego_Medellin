<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>¬øD√≥nde est√° el ladr√≥n? ‚Äî Medell√≠n</title>

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin=""/>

  <style>
    :root{
      --bg:#0f1724; --card:#0b1220; --muted:#cbd5e1; --accent:#66e0a3; --accent2:#60a5fa;
      --glass: rgba(255,255,255,0.03);
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family:Inter,system-ui,Arial, sans-serif; background:linear-gradient(180deg,#071025 0%, #0b1330 100%);
      color:var(--muted); min-height:100vh; display:flex; flex-direction:column; align-items:center; padding:18px;
    }

    header{ width:100%; max-width:1100px; display:flex; justify-content:space-between; align-items:center; gap:12px; margin-bottom:18px; }
    h1{ color:white; margin:0; font-size:20px; letter-spacing:.2px }
    .sub{ opacity:.7; font-size:13px }

    main{ width:100%; max-width:1100px; display:grid; grid-template-columns: 1fr 420px; gap:18px; align-items:start; }
    @media (max-width:980px){ main{ grid-template-columns: 1fr; } }

    .card{ background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border-radius:14px; padding:16px; border:1px solid rgba(255,255,255,0.04); box-shadow: 0 8px 30px rgba(2,6,23,0.6); }

    .controls{ display:flex; gap:8px; flex-wrap:wrap; }
    .btn{ background:linear-gradient(135deg,var(--accent),#2dbd8b); color:#042022; border:none; padding:8px 12px; border-radius:10px; cursor:pointer; font-weight:700; }
    .btn.secondary{ background:linear-gradient(135deg,#8fb5ff,var(--accent2)); color:#042022; }
    .btn.ghost{ background:transparent; border:1px solid rgba(255,255,255,0.06); color:var(--muted); }

    .status{ display:flex; gap:12px; align-items:center; margin-bottom:10px; }
    .badge{ background:var(--glass); padding:6px 10px; border-radius:999px; font-size:13px; border:1px solid rgba(255,255,255,0.04); }

    #clue{ font-size:18px; line-height:1.4; margin:12px 0; color:#e6eef7; }
    .choices{ display:grid; gap:10px; grid-template-columns: repeat(2,1fr); }
    @media (max-width:560px){ .choices{ grid-template-columns: 1fr; } }

    button.choice{ padding:10px 12px; border-radius:12px; border:none; cursor:pointer; font-weight:800; background:rgba(255,255,255,0.04); color:var(--muted); box-shadow: inset 0 0 0 1px rgba(255,255,255,0.02); }
    button.choice:hover{ transform:translateY(-3px); background:rgba(255,255,255,0.06); }

    #mapCard{ display:flex; flex-direction:column; gap:10px; }
    #map{ width:100%; height:440px; border-radius:10px; border:1px solid rgba(255,255,255,0.04); }

    .log{ max-height:220px; overflow:auto; margin-top:8px; padding-right:6px; font-size:13px; color:#c9d7e9; }
    .log div{ padding:6px 8px; border-radius:8px; background:rgba(255,255,255,0.01); margin-bottom:6px; }

    footer{ margin-top:16px; color:rgba(255,255,255,0.45); font-size:13px; }
  </style>
</head>
<body>

  <header>
    <div>
      <h1>¬øD√≥nde est√° el ladr√≥n? ‚Äî Medell√≠n, Antioquia</h1>
      <div class="sub">Sigue 5 pistas sencillas. Si fallas, empiezas de nuevo con pistas distintas.</div>
    </div>
    <div class="controls">
      <button class="btn" id="btn-new">üîé Nuevo caso</button>
      <button class="btn secondary" id="btn-hint">üí° Pista extra</button>
      <button class="btn ghost" id="btn-reset">‚ôªÔ∏è Reiniciar</button>
    </div>
  </header>

  <main>
    <!-- Panel juego -->
    <section class="card">
      <div class="status">
        <div class="badge">Pista <b id="stepLabel">0</b>/5</div>
        <div class="badge">Intentos: <b id="attempts">0</b></div>
        <div class="badge">Ruta: <b id="routeLen">0</b> puntos</div>
      </div>

      <div id="clue">Pulsa <b>Nuevo caso</b> para comenzar.</div>

      <div id="choices" class="choices" aria-live="polite"></div>

      <div style="margin-top:12px; display:flex; gap:8px; align-items:center; flex-wrap:wrap;">
        <button class="btn secondary" id="btn-skip">‚è≠ Omitir (1 vez)</button>
        <div style="flex:1"></div>
        <button class="btn ghost" id="btn-showRoute" title="Mostrar ruta (solo al ganar)">üìç Ver ruta</button>
      </div>

      <h4 style="margin-top:14px">Registro</h4>
      <div class="log" id="log"></div>
    </section>

    <!-- Panel mapa -->
    <aside class="card" id="mapCard">
      <div style="display:flex; justify-content:space-between; align-items:center;">
        <div>
          <strong>Mapa del recorrido</strong>
          <div class="sub" style="margin-top:4px">Al atrapar al ladr√≥n ver√°s el recorrido trazado.</div>
        </div>
        <div style="display:flex; gap:8px">
          <button class="btn secondary" id="btn-fit">üîé Enfocar</button>
          <button class="btn" id="btn-play">‚ñ∂Ô∏è Reproducir</button>
        </div>
      </div>
      <div id="map"></div>
    </aside>
  </main>

  <footer>Guarda este archivo como <code>juego_medellin.html</code> y √°brelo en tu navegador.</footer>

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>

  <script>
  /******************************************
   * Juego: ¬øD√≥nde est√° el ladr√≥n? - Medell√≠n
   * Archivo √∫nico: HTML + CSS + JS
   ******************************************/

  // ---------- Datos (lugares representativos de Medell√≠n y cercan√≠as) ----------
  const PLACES = [
    { name: 'Centro de Medell√≠n', lat: 6.2442, lng: -75.5812 },
    { name: 'El Poblado',        lat: 6.2080, lng: -75.5670 },
    { name: 'Laureles',         lat: 6.2440, lng: -75.5960 },
    { name: 'Bello',            lat: 6.3380, lng: -75.5650 },
    { name: 'Envigado',         lat: 6.1700, lng: -75.5850 },
    { name: 'Itag√º√≠',           lat: 6.1710, lng: -75.6110 },
    { name: 'Sabaneta',         lat: 6.1500, lng: -75.6150 },
    { name: 'Santa Elena',      lat: 6.2600, lng: -75.4900 },
    { name: 'San Javier',       lat: 6.2561, lng: -75.6128 },
    { name: 'Candelaria',       lat: 6.2670, lng: -75.5680 }
  ];

  // ------------- Plantillas de pistas sencillas (f√°ciles y entendibles) -------------
  // Cada pista se genera combinando: outfit, vista en lugar (lugar actual), transporte o acci√≥n.
  const OUTFITS = ['una chaqueta roja', 'una gorra negra', 'un saco amarillo', 'una camiseta verde', 'una bufanda gris'];
  const TRANSPORTS = ['se subi√≥ al Metro', 'tom√≥ un taxi', 'subi√≥ a un bus', 'entr√≥ al Metrocable', 'camin√≥ hacia la estaci√≥n'];
  const ACTIONS = ['compr√≥ una arepa', 'tom√≥ tinto', 'hizo fotos', 'pregunt√≥ por direcciones', 'llevaba una mochila grande'];
  const OPENINGS = ['Un testigo dice', 'La c√°mara cercana muestra', 'Alguien cont√≥', 'Un vendedor comenta', 'Se report√≥ que'];

  // ------------------ Estado del juego ------------------
  const GAME = {
    route: [],      // lugares objetivo (5 pasos)
    step: 0,        // √≠ndice actual (0..4)
    attempts: 0,    // respuestas fallidas
    usedSkip: false,// control de omitir
    map: null,
    markers: [],
    polyline: null,
    playingRoute: false
  };

  // --------------- Helpers ---------------
  const $ = (sel) => document.querySelector(sel);
  const pick = (arr) => arr[Math.floor(Math.random()*arr.length)];
  const shuffle = (arr) => arr.slice().sort(()=>Math.random()-0.5);
  const log = (txt) => { const el = document.createElement('div'); el.textContent = txt; $('#log').prepend(el); };

  // --------------- UI elements ---------------
  const clueEl = $('#clue');
  const choicesEl = $('#choices');
  const stepLabel = $('#stepLabel');
  const attemptsEl = $('#attempts');
  const routeLenEl = $('#routeLen');

  // --------------- Generador de pistas ---------------
  function buildClue(place){
    // Tres tipos: outfit -> transporte -> acci√≥n (aleatorio)
    const type = Math.random();
    let text;
    if(type < 0.35){
      text = `${pick(OPENINGS)} lo vieron con ${pick(OUTFITS)} cerca de ${place.name}.`;
    } else if(type < 0.7){
      text = `${pick(OPENINGS)} dicen que ${pick(TRANSPORTS)} en la zona de ${place.name}.`;
    } else {
      text = `${pick(OPENINGS)} comentan que ${pick(ACTIONS)} en ${place.name}.`;
    }
    return text;
  }

  // --------------- Flujo de juego ---------------
  function newCase(){
    GAME.route = shuffle(PLACES).slice(0,5);
    GAME.step = 0;
    GAME.attempts = 0;
    GAME.usedSkip = false;
    $('#log').innerHTML = '';
    updateStatus();
    renderStep();
    resetMap(true);
    log('üóÇÔ∏è Nuevo caso generado. Sigue las pistas.');
  }

  function renderStep(){
    const place = GAME.route[GAME.step];
    const clue = buildClue(place);
    clueEl.textContent = clue;

    // Opciones: 1 correcta + 2 se√±uelos
    const others = shuffle(PLACES.filter(p=>p.name !== place.name)).slice(0,2);
    const opts = shuffle([place, ...others]);

    choicesEl.innerHTML = '';
    opts.forEach(opt => {
      const btn = document.createElement('button');
      btn.className = 'choice';
      btn.textContent = opt.name;
      btn.onclick = () => choose(opt.name === place.name);
      choicesEl.appendChild(btn);
    });

    updateStatus();
  }

  function choose(correct){
    if(correct){
      log(`‚úÖ Correcto: ${GAME.route[GAME.step].name}`);
      // agregar marcador al mapa (se ver√° completo al ganar)
      GAME.step++;
      if(GAME.step >= 5){
        win();
      } else {
        renderStep();
      }
    } else {
      GAME.attempts++;
      attemptsEl.textContent = GAME.attempts;
      log('‚ùå Respuesta incorrecta. Reiniciando el caso con nuevas pistas.');
      toast('Fallaste. Se gener√≥ un nuevo caso.');
      // reiniciar caso con nuevas pistas
      newCase();
    }
    updateStatus();
  }

  function hint(){
    // Pista adicional: indica tipo de outfit o transporte del lugar actual
    const p = GAME.route[GAME.step];
    const extra = Math.random() < 0.5 ? `Pista extra: llevaba ${pick(OUTFITS)}.` : `Pista extra: ${pick(TRANSPORTS)}.`;
    toast(extra, 2400);
    log('üí° ' + extra);
  }

  function skip(){
    if(GAME.usedSkip){
      toast('Ya usaste tu omitir.');
      return;
    }
    GAME.usedSkip = true;
    log(`‚è≠ Omitida la pista ${GAME.step+1} (${GAME.route[GAME.step].name}).`);
    GAME.step++;
    if(GAME.step >= 5) win();
    else renderStep();
    updateStatus();
  }

  // --------------- Ganar: mostrar ruta ---------------
  function win(){
    clueEl.textContent = 'üéâ ¬°Atrapaste al ladr√≥n! Observa el mapa con su recorrido.';
    choicesEl.innerHTML = '';
    drawRoute();
    log('üß∑ Caso resuelto. Se muestra la ruta del ladr√≥n.');
    toast('¬°Buen trabajo, detective!');
  }

  // --------------- Mapa (Leaflet) ---------------
  function initMap(){
    if(GAME.map) return;
    GAME.map = L.map('map', { zoomControl:true }).setView([6.2442, -75.5812], 12);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19, attribution: '&copy; OpenStreetMap'
    }).addTo(GAME.map);
    GAME.polyline = L.polyline([], { color:'#ff6b6b', weight:4, dashArray: '' }).addTo(GAME.map);
  }

  function resetMap(clearAll=false){
    initMap();
    GAME.polyline.setLatLngs([]);
    GAME.markers.forEach(m=>m.remove());
    GAME.markers = [];
    if(clearAll) GAME.map.setView([6.2442, -75.5812], 12);
  }

  function drawRoute(){
    resetMap();
    const latlngs = GAME.route.map(p=>[p.lat, p.lng]);
    GAME.polyline.setLatLngs(latlngs);
    GAME.markers = GAME.route.map((p,i) => {
      const mk = L.marker([p.lat,p.lng]).addTo(GAME.map).bindPopup(`<b>${i+1}. ${p.name}</b>`);
      return mk;
    });
    fitRoute();
  }

  function fitRoute(){
    const latlngs = GAME.route.map(p=>[p.lat, p.lng]);
    if(!latlngs.length) return;
    GAME.map.fitBounds(L.latLngBounds(latlngs).pad(0.15));
  }

  async function playRoute(){
    if(GAME.playingRoute) return;
    if(!GAME.markers.length) return;
    GAME.playingRoute = true;
    for(let i=0;i<GAME.markers.length;i++){
      GAME.markers[i].openPopup();
      await wait(900);
      GAME.markers[i].closePopup();
    }
    GAME.playingRoute = false;
  }

  function wait(ms){ return new Promise(res => setTimeout(res, ms)); }

  // --------------- UI helpers ---------------
  function updateStatus(){
    stepLabel.textContent = Math.min(GAME.step+1, 5);
    attemptsEl.textContent = GAME.attempts;
    routeLenEl.textContent = GAME.route.length;
  }

  // small toast
  function toast(msg, ms=1600){
    const el = document.createElement('div');
    el.textContent = msg;
    Object.assign(el.style, { position:'fixed', left:'50%', transform:'translateX(-50%)', bottom:'22px', padding:'10px 14px', background:'#071827', color:'#dff6ea', borderRadius:'10px', border:'1px solid rgba(255,255,255,0.06)', zIndex:9999 });
    document.body.appendChild(el);
    setTimeout(()=> el.style.opacity='0.01', ms-300);
    setTimeout(()=> el.remove(), ms);
  }

  // --------------- Eventos DOM ---------------
  document.getElementById('btn-new').addEventListener('click', newCase);
  document.getElementById('btn-hint').addEventListener('click', hint);
  document.getElementById('btn-reset').addEventListener('click', () => { toast('Caso reiniciado'); newCase(); });
  document.getElementById('btn-skip').addEventListener('click', skip);
  document.getElementById('btn-showRoute').addEventListener('click', drawRoute);
  document.getElementById('btn-fit').addEventListener('click', fitRoute);
  document.getElementById('btn-play').addEventListener('click', playRoute);

  // init map lazy on load
  window.addEventListener('load', () => {
    initMap();
    // prefill routeLen 0
    updateStatus();
  });

  </script>
</body>
</html>
